@namespace DayLog.Components.Layout
@inherits LayoutComponentBase

@using DayLog.Components.Layout

@inject DayLog.Services.Interfaces.IAuthService AuthService
@inject NavigationManager Navigation

<div class="app-shell">
    <aside class="sidebar" role="navigation">
        <div class="sidebar-inner">
            <div class="brand">
                <img src="images/appicon.svg" alt="logo" />
                <span class="brand-title">DayLog</span>
            </div>
            <NavMenu />
        </div>
    </aside>

    <div class="content-area">
        @if (!Navigation.Uri.EndsWith("/Edit-entry", StringComparison.OrdinalIgnoreCase))
        {
            <header class="topbar">
                <button class="hamburger d-lg-none" @onclick="ToggleSidebar" aria-label="Toggle navigation">
                    &#9776;
                </button>
                <div class="topbar-right">
                    <!-- optional: page title, user actions -->
                </div>
            </header>
        }

        <main class="main-container">
            @Body
        </main>

        <!-- footer removed per design preference -->
    </div>
</div>

@code {
    private bool _sidebarCollapsed;

    protected override async Task OnInitializedAsync()
    {
        // Only check auth if not already on /login
        if (!Navigation.Uri.EndsWith("/login", StringComparison.OrdinalIgnoreCase))
        {
            var loggedIn = await AuthService.IsLoggedInAsync();
            if (!loggedIn)
            {
                Navigation.NavigateTo("/login", true);
                return;
            }
        }
    }

    private void ToggleSidebar()
    {
        _sidebarCollapsed = !_sidebarCollapsed;
        // Optionally, toggle a CSS class on the root element via JS interop
    }
}