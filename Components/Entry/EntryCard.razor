@using DayLog.Models
@using Microsoft.AspNetCore.Components
@inject NavigationManager Navigation
@inject IJSRuntime JS

<div class="card mb-3">
    <div class="card-body d-flex justify-content-between align-items-start">
        <div>
            <div class="text-muted small">@Entry.EntryDate.ToString("yyyy-MM-dd")</div>
            <h5 class="card-title mt-1">
                @(string.IsNullOrWhiteSpace(Entry.Title) ? "(no title)" : Entry.Title)
                @if (!string.IsNullOrEmpty(GetMoodEmoji(Entry.PrimaryMoodId)))
                {
                    <span class="ms-2">@GetMoodEmoji(Entry.PrimaryMoodId)</span>
                }
            </h5>
            <div class="card-text text-muted">@((Entry.PreviewHtml ?? string.Empty))</div>
            @if (!string.IsNullOrWhiteSpace(Entry.TagsCsv))
            {
                <div class="mt-2">
                    @foreach (var t in (Entry.TagsCsv ?? string.Empty).Split(',', StringSplitOptions.RemoveEmptyEntries).Select(s => s.Trim()))
                    {
                        <span class="badge bg-light text-dark me-1">@t</span>
                    }
                </div>
            }
        </div>

        @if (ShowActions)
        {
            <div class="btn-group-vertical ms-3">
                <button class="btn btn-sm btn-primary mb-1" @onclick="() => OnEdit.InvokeAsync(Entry.Id)">Edit</button>
                <button class="btn btn-sm btn-outline-danger" @onclick="OnDeleteClicked">Delete</button>
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public EntryDisplayModel Entry { get; set; } = null!;
    [Parameter] public EventCallback<int> OnEdit { get; set; }
    [Parameter] public EventCallback<int> OnDelete { get; set; }
    [Parameter] public bool ShowActions { get; set; } = true;

    private static string GetMoodEmoji(int id)
    {
        return id switch
        {
            1 => "ðŸ˜Š",
            2 => "ðŸ˜",
            3 => "ðŸ˜¢",
            4 => "ðŸ¤©",
            5 => "ðŸ˜°",
            _ => string.Empty
        };
    }

    private async Task OnDeleteClicked()
    {
        var ok = await JS.InvokeAsync<bool>("confirm", "Delete this entry? This cannot be undone.");
        if (!ok) return;
        await OnDelete.InvokeAsync(Entry.Id);
    }
}
